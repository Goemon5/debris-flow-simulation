<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenFOAM åŒ‚ã„æ‹¡æ•£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        .status {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .status-item {
            background: #34495e;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        .status-item.success { background: #27ae60; }
        .status-item.running { background: #f39c12; }
        .status-item.pending { background: #95a5a6; }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .plot-container {
            height: 500px;
            margin: 20px 0;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .control-button.active {
            background: #e74c3c;
        }

        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .parameter-table th,
        .parameter-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .parameter-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .log-container {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s ease;
        }

        .data-upload {
            border: 2px dashed #3498db;
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .data-upload:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .data-upload input {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸŒ¬ï¸ OpenFOAM åŒ‚ã„æ‹¡æ•£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
            <p>ç“¦ç¤«ç’°å¢ƒã«ãŠã‘ã‚‹åŒ‚ã„ç‰©è³ªã®æ‹¡æ•£è§£æçµæœ</p>
            
            <div class="status">
                <div class="status-item success" id="mesh-status">ãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆ: å®Œäº†</div>
                <div class="status-item success" id="flow-status">æµä½“è§£æ: å®Œäº†</div>
                <div class="status-item running" id="scalar-status">ã‚¹ã‚«ãƒ©ãƒ¼è¼¸é€: å®Ÿè¡Œä¸­</div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div id="progress-text">é€²æ—: 0% (æ™‚åˆ» 1001/1005)</div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="content-grid">
            <!-- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¡¨ç¤º -->
            <div class="card">
                <h2>ğŸ“Š ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š</h2>
                <table class="parameter-table">
                    <tr><th>é …ç›®</th><th>å€¤</th></tr>
                    <tr><td>åŒ‚ã„æºä½ç½®</td><td>(2, -3, 0.5) m</td></tr>
                    <tr><td>åŒ‚ã„æºåŠå¾„</td><td>0.3 m</td></tr>
                    <tr><td>é¢¨é€Ÿ</td><td>1.0 m/s (Xæ–¹å‘)</td></tr>
                    <tr><td>è¨ˆç®—é ˜åŸŸ</td><td>30Ã—35Ã—10 m</td></tr>
                    <tr><td>ãƒ¡ãƒƒã‚·ãƒ¥ã‚»ãƒ«æ•°</td><td>637,147 cells</td></tr>
                    <tr><td>æ™‚é–“åˆ»ã¿</td><td>0.1 s</td></tr>
                    <tr><td>ç·æ™‚é–“</td><td>0.4 s (4ã‚¹ãƒ†ãƒƒãƒ—)</td></tr>
                </table>
            </div>

            <!-- ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
            <div class="card">
                <h2>ğŸ“ çµæœãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</h2>
                <div class="data-upload" onclick="document.getElementById('file-input').click()">
                    <input type="file" id="file-input" multiple accept=".txt,.csv,.dat" onchange="handleFileUpload(event)">
                    <p>ğŸ“¤ OpenFOAMã®çµæœãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—<br>ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</p>
                    <small>å¯¾å¿œå½¢å¼: .txt, .csv, .dat</small>
                </div>
            </div>
        </div>

        <!-- å¯è¦–åŒ–ã‚¨ãƒªã‚¢ -->
        <div class="card full-width">
            <h2>ğŸ¨ 3Då¯è¦–åŒ–</h2>
            
            <div class="controls">
                <button class="control-button active" onclick="show3DView()">3Dæ¿ƒåº¦åˆ†å¸ƒ</button>
                <button class="control-button" onclick="showXYSlice()">XYæ–­é¢</button>
                <button class="control-button" onclick="showXZSlice()">XZæ–­é¢</button>
                <button class="control-button" onclick="showTimeSeries()">æ™‚é–“ç™ºå±•</button>
                <button class="control-button" onclick="showStreamlines()">æµç·šè¡¨ç¤º</button>
            </div>

            <div class="plot-container" id="main-plot"></div>
        </div>

        <!-- ãƒ­ã‚°è¡¨ç¤º -->
        <div class="card full-width">
            <h2>ğŸ“ å®Ÿè¡Œãƒ­ã‚°</h2>
            <div class="log-container" id="log-container">
                <div>OpenFOAM ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹...</div>
                <div>blockMesh: ãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆå®Œäº† (637,147 cells)</div>
                <div>snappyHexMesh: ç“¦ç¤«å‘¨è¾ºãƒ¡ãƒƒã‚·ãƒ¥ç´°åˆ†åŒ–å®Œäº†</div>
                <div>foamRun: æµä½“è§£æå®Ÿè¡Œä¸­...</div>
                <div>æ™‚åˆ» 1001: åæŸåˆ¤å®š OK</div>
                <div>æ™‚åˆ» 1002: åæŸåˆ¤å®š OK</div>
                <div>æ™‚åˆ» 1003: åæŸåˆ¤å®š OK</div>
                <div class="running">æ™‚åˆ» 1004: è¨ˆç®—ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        // é€²æ—ãƒãƒ¼ã®æ›´æ–°
        let progress = 75; // 75%å®Œäº†ã¨ä»®å®š
        document.getElementById('progress-fill').style.width = progress + '%';
        document.getElementById('progress-text').textContent = 
            `é€²æ—: ${progress}% (æ™‚åˆ» 1004/1005)`;

        // 3Då¯è¦–åŒ–ã®åˆæœŸåŒ–
        function initializePlot() {
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§3Dæ¿ƒåº¦åˆ†å¸ƒã‚’ä½œæˆ
            const x = [], y = [], z = [], concentration = [];
            
            // åŒ‚ã„æºå‘¨è¾ºã®ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            for (let i = -10; i <= 20; i += 1) {
                for (let j = -15; j <= 10; j += 1) {
                    for (let k = 0; k <= 6; k += 0.5) {
                        const dist = Math.sqrt(Math.pow(i-2, 2) + Math.pow(j+3, 2) + Math.pow(k-0.5, 2));
                        const windEffect = i >= 2 ? Math.exp(-(i-2)/8) : Math.exp(-(2-i)/3) * 0.1;
                        const conc = windEffect * Math.exp(-dist/4) * Math.exp(-Math.pow(j+3, 2)/15);
                        
                        if (conc > 0.01) {
                            x.push(i);
                            y.push(j);
                            z.push(k);
                            concentration.push(conc);
                        }
                    }
                }
            }

            const trace = {
                x: x,
                y: y,
                z: z,
                mode: 'markers',
                marker: {
                    size: concentration.map(c => c * 15 + 2),
                    color: concentration,
                    colorscale: [
                        [0, 'rgb(255,255,255)'],
                        [0.2, 'rgb(255,255,0)'],
                        [0.5, 'rgb(255,165,0)'],
                        [0.8, 'rgb(255,69,0)'],
                        [1, 'rgb(139,0,0)']
                    ],
                    opacity: 0.8,
                    colorbar: {
                        title: "æ¿ƒåº¦",
                        titleside: "right"
                    }
                },
                type: 'scatter3d',
                name: 'åŒ‚ã„æ¿ƒåº¦'
            };

            // åŒ‚ã„æº
            const source = {
                x: [2],
                y: [-3],
                z: [0.5],
                mode: 'markers',
                marker: {
                    size: 20,
                    color: 'red',
                    symbol: 'diamond'
                },
                type: 'scatter3d',
                name: 'åŒ‚ã„æº'
            };

            const layout = {
                title: {
                    text: '3D åŒ‚ã„æ¿ƒåº¦åˆ†å¸ƒ',
                    font: { size: 18 }
                },
                scene: {
                    xaxis: { title: 'X (m)', range: [-15, 15] },
                    yaxis: { title: 'Y (m)', range: [-20, 15] },
                    zaxis: { title: 'Z (m)', range: [-2, 8] },
                    camera: {
                        eye: { x: 1.5, y: 1.5, z: 0.8 },
                        center: { x: 0, y: 0, z: 0 }
                    },
                    aspectmode: 'cube'
                },
                showlegend: true,
                margin: { l: 0, r: 0, b: 0, t: 40 }
            };

            Plotly.newPlot('main-plot', [trace, source], layout, {responsive: true});
        }

        // è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function show3DView() {
            updateActiveButton(event.target);
            initializePlot();
        }

        function showXYSlice() {
            updateActiveButton(event.target);
            
            const x = [], y = [], z = [];
            for (let i = -15; i <= 15; i += 0.5) {
                const row_y = [], row_z = [];
                for (let j = -20; j <= 15; j += 0.5) {
                    const dist = Math.sqrt(Math.pow(i-2, 2) + Math.pow(j+3, 2));
                    const windEffect = i >= 2 ? Math.exp(-(i-2)/10) : Math.exp(-(2-i)/5) * 0.1;
                    const conc = windEffect * Math.exp(-dist/8) * Math.exp(-Math.pow(j+3, 2)/25);
                    
                    row_y.push(j);
                    row_z.push(conc);
                }
                if (i === -15) y.push(...row_y);
                x.push(i);
                z.push(row_z);
            }

            const trace = {
                x: x,
                y: y[0] !== undefined ? y.slice(0, z[0].length) : [],
                z: z,
                type: 'contour',
                colorscale: 'Hot',
                colorbar: { title: "æ¿ƒåº¦" },
                contours: {
                    showlines: true,
                    linewidth: 1,
                    linecolor: 'black'
                }
            };

            const source = {
                x: [2],
                y: [-3],
                mode: 'markers',
                marker: { size: 15, color: 'blue', symbol: 'star' },
                type: 'scatter',
                name: 'åŒ‚ã„æº'
            };

            const layout = {
                title: 'XYå¹³é¢ã§ã®åŒ‚ã„åˆ†å¸ƒ (Z=0.5m)',
                xaxis: { title: 'X (m)' },
                yaxis: { title: 'Y (m)' },
                showlegend: true
            };

            Plotly.newPlot('main-plot', [trace, source], layout, {responsive: true});
        }

        function showXZSlice() {
            updateActiveButton(event.target);
            // XZæ–­é¢ã®å®Ÿè£…ï¼ˆçœç•¥ï¼‰
        }

        function showTimeSeries() {
            updateActiveButton(event.target);
            // æ™‚é–“ç™ºå±•ã®å®Ÿè£…ï¼ˆçœç•¥ï¼‰
        }

        function showStreamlines() {
            updateActiveButton(event.target);
            // æµç·šè¡¨ç¤ºã®å®Ÿè£…ï¼ˆçœç•¥ï¼‰
        }

        function updateActiveButton(activeBtn) {
            document.querySelectorAll('.control-button').forEach(btn => 
                btn.classList.remove('active'));
            activeBtn.classList.add('active');
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        function handleFileUpload(event) {
            const files = event.target.files;
            const logContainer = document.getElementById('log-container');
            
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    logContainer.innerHTML += `<div>ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†: ${file.name}</div>`;
                    logContainer.scrollTop = logContainer.scrollHeight;
                    
                    // ã“ã“ã§å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’è¡Œã†
                    processOpenFOAMData(content, file.name);
                };
                reader.readAsText(file);
            }
        }

        function processOpenFOAMData(content, filename) {
            // OpenFOAMãƒ‡ãƒ¼ã‚¿ã®è§£æå‡¦ç†ï¼ˆå®Ÿè£…çœç•¥ï¼‰
            console.log(`Processing ${filename}:`, content.substring(0, 200));
        }

        // è‡ªå‹•æ›´æ–°ï¼ˆå®Ÿéš›ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯å®šæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ï¼‰
        function simulateProgress() {
            setTimeout(() => {
                if (progress < 100) {
                    progress += 5;
                    document.getElementById('progress-fill').style.width = progress + '%';
                    document.getElementById('progress-text').textContent = 
                        `é€²æ—: ${progress}% (æ™‚åˆ» ${Math.min(1001 + Math.floor(progress/25), 1005)}/1005)`;
                    
                    if (progress >= 100) {
                        document.getElementById('scalar-status').textContent = 'ã‚¹ã‚«ãƒ©ãƒ¼è¼¸é€: å®Œäº†';
                        document.getElementById('scalar-status').className = 'status-item success';
                        
                        const logContainer = document.getElementById('log-container');
                        logContainer.innerHTML += '<div class="success">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ï¼</div>';
                        logContainer.scrollTop = logContainer.scrollHeight;
                    }
                    
                    simulateProgress();
                }
            }, 2000);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.onload = function() {
            initializePlot();
            simulateProgress();
        };
    </script>
</body>
</html>